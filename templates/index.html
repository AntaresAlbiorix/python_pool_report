<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!--<!DOCTYPE HTML>-->
<html>
<head> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/> 
<title>Настройка продукта</title>
<!--
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script> 
-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>



 <link rel="stylesheet" type="text/css" href="/static/styles4lat.css"/>
 <style type="text/css">
  
	input[type="button"], input[type="submit"], button  {
				background-color: #eef3f7;
				color: black;
				width:100px;
		}
 </style> 
</head>

<body>

	<form class="form" name="myform">	
	<div id="header"> 
		<h2 style=" display:inline-block; float:left;  margin: 0px; margin-left: 15px; margin-top: 5px; padding: 0px; valign:middle;"> 
		Денежные потоки по страховому портфелю
		</h2>
		<button id="submit_button" data-loading-text="Падажжи" type="button"  style=" display:inline-block; float:right; margin-right: 25px; margin-top: 5px; padding: 0px; width:120px;  height: 30px;">Отправить</button>
		<button type="button"  style=" display:inline-block; float:right; margin-right: 25px; margin-top: 5px; padding: 0px; width:120px;  height: 30px;"	 onclick="tableToExcel('tab_result', 'W3C Example Table')"> Export to Excel</button>
	</div>  
	
	<div id="container">
		<script>
		   $(document).ready(function(){
            $("#submit_button").click(function(){
                var btn = $(this);
                btn.button('loading');
				//делаем строку из отмеченных чекбоксов
				function implode_array(element_name, nvl='None')
				{
					var element_array = Array.from(document.getElementsByName(element_name));
					console.log(element_array.length)
					var element_value_array = [];
					
					element_value_array = element_array.filter(element => element.checked == true);
					element_value_array = element_value_array.map(element => element.value); 
					
					if (element_value_array.length===0) { 
						return nvl;
						}
					else {
						return element_value_array.join('|')
					};
				};
							
				var strat=implode_array('strat[]',0);
				
				var optdate=Array.from(document.getElementsByName('optdate[]')).filter(element => element.checked == true);
				if (optdate.length === document.getElementsByName('optdate[]').length) {
					optdate="all"}
				else{
					optdate=implode_array('optdate[]',0);
				};
				
				//собираем переменные и идем в ручку 
                $.get("/get_pool_details", {strat: strat, optdate: optdate}, function( result_table ) { 
                    $("#center3").html(result_table); //div id куда должен встать результат из ручки
                    btn.button('reset');
                });
            });
        });
					 
//					 document.write(document.getElementsByName('UWdate[]').length)						
//					 document.write(document.getElementsByName('optdate[]').length)				
//					 $jigurda="\"".$field."\" \"".$sc."\" \"".$nst."\" \"".$status."\" \"".$bsns_type."\" \"".$strat."\" \"".$optdate."\" \"".$UWdate."\" \"".$planfact."\"" . " \"".$curr."\"";					 
		</script>
			<div id="center1" class="column">
				<div id="upleft" 		class="row"> 	
					
					<h4  style="padding: 0px; margin:0px;margin-bottom:5px;">Стратегии:</h4>
						
						<input type="button" name="Check_All_strats" value="Снять все" class="butt" onClick="master_check('strat[]')" id="strat[]"> </br>			
						<input type="checkbox"   name="strat[]"  value="1"  checked >Глобальная экономика 3 года			<Br/>					
						<input type="checkbox"   name="strat[]"  value="2"  checked >Лидеры фармацевтики                 <Br/>
						<input type="checkbox"   name="strat[]"  value="3"  checked >Купонный доход                      <Br/>
						<input type="checkbox"   name="strat[]"  value="4"  checked >Глобальная экономика 5 лет          <Br/>
						<input type="checkbox"   name="strat[]"  value="5"  checked >Глобальная экономика 3 года - 2     <Br/>
						<input type="checkbox"   name="strat[]"  value="6"  checked >Глобальная экономика 5 лет  - 2     <Br/>
						<input type="checkbox"   name="strat[]"  value="7"  checked >Лидеры фармацевтики  - 2            <Br/>
						<input type="checkbox"   name="strat[]"  value="8"  checked >Купонный доход - 2                  <Br/>
						<input type="checkbox"   name="strat[]"  value="9"  checked >Сбалансированный портфель 3 года    <Br/>
						<input type="checkbox"   name="strat[]"  value="10" checked >Сбалансированный портфель 5 лет     <Br/>

				</div>
			</div>
			<div id="center2" class="column">
				<!--<h2>meow</h2>-->
							
				<div id="upcenter" 		class="row">  
					<h4  style="padding: 0px; margin:0px;margin-bottom:5px;">Даты инвестирования:</h4>
						
						<input type="button" name="Check_All_opts" value="Снять все" class="chkbtn"	onClick="master_check('optdate[]')" id = "optdate[]"> </br>
						<input type="checkbox"  name="optdate[]"   value = "21.04.2017"	checked >	21.04.2017  <Br/>
						<input type="checkbox"  name="optdate[]"   value = "21.07.2017"	checked >	21.07.2017  <Br/>
						<input type="checkbox"  name="optdate[]"   value = "28.09.2017"	checked >	28.09.2017  <Br/>
						<input type="checkbox"  name="optdate[]"   value = "27.10.2017"	checked >	27.10.2017  <Br/>
						<input type="checkbox"  name="optdate[]"   value = "13.11.2017"	checked >	13.11.2017  <Br/>
						<input type="checkbox"  name="optdate[]"   value = "06.12.2017"	checked >	06.12.2017  <Br/>
						<input type="checkbox"  name="optdate[]"   value = "10.11.2017"	checked >	10.11.2017  <Br/>
						<input type="checkbox"  name="optdate[]"   value = "15.01.2018"	checked >	15.01.2018  <Br/>
						<input type="checkbox"  name="optdate[]"   value = "16.02.2018"	checked >	16.02.2018  <Br/>
						<input type="checkbox"  name="optdate[]"   value = "28.02.2018"	checked >	28.02.2018  <Br/>
						<input type="checkbox"  name="optdate[]"   value = "02.04.2018"	checked >	02.04.2018  <Br/>
						<input type="checkbox"  name="optdate[]"   value = "01.06.2018"	checked >	01.06.2018  <Br/>
						<input type="checkbox"  name="optdate[]"   value = "29.05.2018"	checked >	29.05.2018  <Br/>
						<input type="checkbox"  name="optdate[]"   value = "02.07.2018"	checked >	02.07.2018  <Br/>
						<input type="checkbox"  name="optdate[]"   value = "02.08.2018"	checked >	02.08.2018  <Br/>
						<input type="checkbox"  name="optdate[]"   value = "11.09.2018"	checked >	11.09.2018  <Br/>
						<input type="checkbox"  name="optdate[]"   value = "01.10.2018"	checked >	01.10.2018  <Br/>
						<input type="checkbox"  name="optdate[]"   value = "09.11.2018"	checked >	09.11.2018  <Br/>
						<input type="checkbox"  name="optdate[]"   value = "19.11.2018"	checked >	19.11.2018  <Br/>
						<input type="checkbox"  name="optdate[]"   value = "11.12.2018"	checked >	11.12.2018  <Br/>
						<input type="checkbox"  name="optdate[]"   value = "18.01.2019"	checked >	18.01.2019  <Br/>
						<input type="checkbox"  name="optdate[]"   value = "22.02.2019"	checked >	22.02.2019  <Br/>
						<input type="checkbox"  name="optdate[]"   value = "29.03.2019"	checked >	29.03.2019  <Br/>
						<input type="checkbox"  name="optdate[]"   value = "25.04.2019"	checked >	25.04.2019  <Br/>
						<input type="checkbox"  name="optdate[]"   value = "28.05.2019"	checked >	28.05.2019  <Br/>
						<input type="checkbox"  name="optdate[]"   value = "29.07.2019"	checked >	29.07.2019  <Br/>
						<input type="checkbox"  name="optdate[]"   value = "26.09.2019"	checked >	26.09.2019  <Br/>
				</div>
				<!-- 
				<div id="downcenter" 	class="row">  															
				</div>-->	
			</div>
			<div id="center3" class="column">
				<!-- results from external function -->	
				
			</div>				
	</form> 
		
			<div id="left" class="column">
			</div>

			<div id="right" class="column">	   
			</div> 
		
	</div>
	<div id="clearfix">
	</div>
	<div id="footer">
			 <marquee direction="right" id="web2"  > Тестовый режим </marquee> 
	</div> 
	 







<script>
//функции для проставления чекбоксов "выбрать все"

function master_check(element_name)
{
chk = document.getElementsByName(element_name);
if(document.getElementById(element_name).value=="Выбрать все")

	{
	for (i = 0; i < chk.length; i++)
	chk[i].checked = true ;
	document.getElementById(element_name).value="Снять все";
	}
else{
	for (i = 0; i < chk.length; i++)
	chk[i].checked = false ;
	document.getElementById(element_name).value="Выбрать все";
	}
}
</script>


<script>
//экспорт данных в Excel

 function fnExcelReport() {
	 var dt = new Date();
        var day = dt.getDate();
        var month = dt.getMonth() + 1;
        var year = dt.getFullYear();
        var hour = dt.getHours();
        var mins = dt.getMinutes();
        var postfix = day + "." + month + "." + year + "_" + hour + "." + mins;
				
	 var tab_text = "<table border='2px'><tr bgcolor='#90b4d5'>";
     var textRange; var j = 0;
     tab = document.getElementById('tab_result'); // id of table
	
     for (j = 0 ; j < tab.rows.length ; j++) {		 
         tab_text = tab_text + tab.rows[j].innerHTML + "</tr>";
         //tab_text=tab_text+"</tr>";
     }
	  
     tab_text = tab_text + "</table>";
     tab_text = tab_text.replace(/<A[^>]*>|<\/A>/g, "");//remove if u want links in your table
     tab_text = tab_text.replace(/<img[^>]*>/gi, ""); // remove if u want images in your table
     tab_text = tab_text.replace(/<input[^>]*>|<\/input>/gi, ""); // reomves input params
	 tab_text = tab_text.replace(/-/g, "0" );
	 tab_text = tab_text.replace(/,/g, "" );
	 tab_text = tab_text.replace(/\u0028/g, "-" ); 
	 tab_text = tab_text.replace(/\u0029/g, "" ); 

     let a = $("<a />", {
             href: 'data:application/vnd.ms-excel, ' + encodeURIComponent(tab_text),
             download: 'Portfolio_performance_' + postfix + '.xls'
         })
         .appendTo("body")
         .get(0)
         .click();
         e.preventDefault();
   //  }

     return (sa);
 }
</script>



<script>		
//бегущая строка
	var i=0;
	/*var dt=new Array("0000A0", "A00000", "00A000", "00A0A0", "A000A0", "A0A000");*/
	var dt=new Array("AAAAAA", "000000", "A000A0");
function cl() {// эта функция будет менять цвет текста
	document.getElementById("web2").style.color= dt[i];
	i++;
if (i>dt.length) i=0;
setTimeout("cl()",300);
}
cl();	// первый вызов размещаю после определения объекта
</script>

</body>
</html>